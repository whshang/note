# AI Agent 提示设计：如何让 Agent 听懂你的需求

我刚开始使用 AI Agent 时，总是遇到一个问题："明明我说得很清楚了，为什么 Agent 还是做错了？"

后来我发现，问题不在 Agent，而在我。让 Agent "听懂"，和让人"听懂"，完全是两回事。

## 第一个误区：用人类语言

我想让 Agent 帮我分析一份代码，写了这样的提示："请帮我看看这份代码，看看有没有问题，如果有问题请告诉我怎么改，谢谢！"

Agent 回答：代码看起来没问题，建议保持现有结构，没有发现明显错误。

但实际上，这份代码有严重的性能问题。

问题在哪？

指令不够具体。"看看有没有问题"——什么类型的问题？"怎么改"——改进的方向是什么？

缺少评判标准。什么样的代码算"有问题"？什么样的修改算"好"？

期望不明确。我想要详细的分析，Agent 只给了模糊的判断。

## 第二个误区：过度技术化

吸取教训后，我开始写"技术"的提示："请执行静态代码分析，检查以下指标：时间复杂度、空间复杂度、内存泄漏风险、并发安全问题、代码规范符合度。"

Agent 严格按照指标分析，但忽略了业务逻辑问题，给出的建议过于理论化，没有考虑实际运行环境。

过度技术化让 Agent 变成了"检查工具"，而不是"分析助手"。

## 现在的做法：结构化 Agent 提示

经过多次试错，我总结了一个 Agent 提示设计框架。

### 框架模板

```
【角色】: [Agent 的身份和职责]
【任务】: [具体要完成什么]
【上下文】: [关键背景信息]
【约束】: [必须遵守的规则]
【评判标准】: [如何判断好坏]
【输出格式】: [期望的输出结构]
```

### 实际应用

用上面的代码分析例子，我现在的提示是：

```
【角色】: 资深后端开发工程师，专注性能优化
【任务】: 分析这份代码的性能和可维护性问题
【上下文】: 这是一个高频调用的服务接口，每秒处理 1000+ 请求
【约束】:
- 重点关注数据库查询和循环嵌套
- 考虑内存使用和响应时间
- 提供具体的优化建议
【评判标准】:
- 性能：响应时间 < 100ms
- 可维护性：代码复杂度 < 10（圈复杂度）
【输出格式】:
- 问题列表（按严重程度排序）
- 每个问题的优化建议
- 预期改进效果
```

Agent 现在能准确识别性能瓶颈，提供具体的优化建议，评估改进后的效果，优先处理严重问题。

## 几个技巧

### 角色定义要具体

模糊角色："你是一个代码分析师"

具体角色："你是一个资深后端开发工程师，有 10 年 Java 开发经验，专注高并发系统优化"

具体的角色定义能帮助 Agent 更好地理解任务。

### 任务分解

复杂任务要分解成子任务。分析整个系统，可以分解成：分析数据库性能、分析缓存策略、分析接口响应、分析错误处理。

### 提供评判标准

告诉 Agent 什么是"好"什么是"坏"。

性能标准：响应时间 < 100ms（优秀），响应时间 100-300ms（良好），响应时间 > 300ms（需要优化）。

代码标准：圈复杂度 < 5（优秀），圈复杂度 5-10（良好），圈复杂度 > 10（需要重构）。

### 预期输出格式

明确告诉 Agent 你想要什么格式。

执行摘要（1-2 句话），详细分析（问题 + 建议），优先级排序（紧急 → 重要 → 一般），预期收益（量化改进）。

## 实战案例

### 让 Agent 写测试用例

之前（模糊提示）："请为这个函数写一些测试用例，谢谢！"

现在（结构化）：

```
【角色】: 测试工程师，专注单元测试
【任务】: 为这个函数写单元测试用例
【上下文】: 这是一个用户验证函数，用于生产环境
【约束】:
- 覆盖所有分支逻辑
- 包含边界条件测试
- 使用 Jest 框架
【评判标准】:
- 测试覆盖率 > 90%
- 包含正常流程和异常流程
【输出格式】:
1. 测试用例列表（描述 + 输入 + 期望输出）
2. 完整的测试代码
3. 预期覆盖率
```

结果：测试用例更全面，代码质量更高。

## 检查清单

每次设计 Agent 提示时，我会检查：

角色是否具体？（不是"助手"，而是"XX工程师"）

任务是否明确？（具体要完成什么）

上下文是否充分？（关键背景信息）

约束是否清晰？（必须遵守的规则）

评判标准是否明确？（如何判断好坏）

输出格式是否具体？（期望的具体结构）

## 最后想说

AI Agent 不是人类，它不会"猜测"你的意图。你必须明确告诉它：你是谁（角色）、要做什么（任务）、为什么要做（上下文）、有什么限制（约束）、什么样算好（评判标准）、要做成什么样（输出格式）。

好的 Agent 提示设计，关键在结构化、具体化、标准化、量化。

这套方法让我和 Agent 的协作效率提升了 3 倍。
